!function(f){f(document).ready(function(){f(".admin-page-framework-sections.repeatable-section").each(function(e){var a=(t=f(this).children(".repeatable-section-buttons-model").first()).data(),t=t.find(".admin-page-framework-repeatable-section-buttons").first().detach();f(this).find(".admin-page-framework-section-caption").each(function(){f(this).show();var e=f(t[0].outerHTML);0<f(this).children(".admin-page-framework-collapsible-section-title").children("fieldset").length&&e.addClass("section_title_field_sibling");var a=f(this).find(".admin-page-framework-collapsible-section-title");a.length?(e.find(".repeatable-section-button").removeClass("button-large"),a.append(e)):f(this).prepend(e)}),f(this).updateAdminPageFrameworkRepeatableSections(a)})});var p=AdminPageFrameworkScriptFormMain;f.fn.updateAdminPageFrameworkRepeatableSections=function(e){var a=this,t=a.find(".repeatable-section-add-button").first().closest(".admin-page-framework-sections").attr("id");f.fn.aAdminPageFrameworkRepeatableSectionsOptions||(f.fn.aAdminPageFrameworkRepeatableSectionsOptions=[]),f.fn.aAdminPageFrameworkRepeatableSectionsOptions.hasOwnProperty(t)||(f.fn.aAdminPageFrameworkRepeatableSectionsOptions[t]=f.extend({max:0,min:0,fadein:500,fadeout:500,disabled:0,preserve_values:0},e));e=f.fn.aAdminPageFrameworkRepeatableSectionsOptions[t];f(a).find(".repeatable-section-add-button").on("click",function(){if(f(this).parent().data("disabled")){var e=f(this).parent().data("disabled");return tb_show(e.caption,f(this).attr("href")),!1}return f(this).addAdminPageFrameworkRepeatableSection(),!1}),f(a).find(".repeatable-section-remove-button").on("click",function(){return f(this).removeAdminPageFrameworkRepeatableSection(),!1});a=a.find(".repeatable-section-add-button").first().closest(".admin-page-framework-section").attr("id"),t=jQuery("#"+t).find(".admin-page-framework-section").length;0<e.min&&0<t&&0<e.min-t&&f("#"+a).addAdminPageFrameworkRepeatableSection(a)},f.fn.addAdminPageFrameworkRepeatableSection=function(e){void 0===e&&(e=f(this).closest(".admin-page-framework-section").attr("id"));var a=f("#"+e),t=a.clone(),i=a.closest(".admin-page-framework-sections"),n=i.attr("id"),r=f(this).closest(".admin-page-framework-section-tabs-contents").children(".admin-page-framework-section-tabs").first(),o=i.attr("data-largest_index"),d=f.fn.aAdminPageFrameworkRepeatableSectionsOptions[n].fadein,s=f.fn.aAdminPageFrameworkRepeatableSectionsOptions[n].fadeout,l=f.fn.aAdminPageFrameworkRepeatableSectionsOptions[n].preserve_values,m=f.fn.aAdminPageFrameworkRepeatableSectionsOptions[n].max;if(0!=m&&i.find(".admin-page-framework-section").length>=m){var c=a.find(".admin-page-framework-repeatable-section-buttons").last(),m=f(this).formatPrintText(p.messages.cannotAddMoreSections,m),m=f('<span class="repeatable-section-error" id="repeatable-section-error-'+n+'">'+m+"</span>");return 0<i.find("#repeatable-section-error-"+n).length?i.find("#repeatable-section-error-"+n).replaceWith(m):c.before(m),void m.delay(2e3).fadeOut(s)}l||t.find("input:not([type=radio], [type=checkbox], [type=submit], [type=hidden]),textarea").val(""),t.find(".repeatable-section-error").remove();s=t.find(".admin-page-framework-section-caption").first().attr("data-section_tab");s&&"_default"!==s||t.find(".admin-page-framework-section-title").not(".admin-page-framework-collapsible-section-title").hide(),"function"==typeof t.enableAdminPageFrameworkCollapsibleButton&&t.find(".admin-page-framework-collapsible-sections-title, .admin-page-framework-collapsible-section-title").enableAdminPageFrameworkCollapsibleButton(),t.hide().insertAfter(a),r.length&&!a.hasClass("is_subsection_collapsible")||t.delay(100).fadeIn(d),b(t,o,i),a.find("input[type=radio][checked=checked]").prop("checked",!0),f(t).find(".admin-page-framework-field").each(function(e){f(this).updateAdminPageFrameworkRepeatableFields(),f(this).trigger("admin-page-framework_added_repeatable_field",[f(this).data("type"),f(this).attr("id"),1,o,e]),f(this).trigger("admin-page-framework_repeated_field",[1,jQuery(t).closest(".admin-page-framework-sections")])}),t.updateAdminPageFrameworkRepeatableSections(),t.find(".admin-page-framework-fields.sortable").each(function(){f(this).enableAdminPageFrameworkSortableFields()}),0<r.length&&!a.hasClass("is_subsection_collapsible")&&((e=(a=r.find("#section_tab-"+e)).clone()).removeClass("active"),l||e.find("input:not([type=radio], [type=checkbox], [type=submit], [type=hidden]),textarea").val(""),e.hide().insertAfter(a).delay(10).fadeIn(d),b(e,o,i),r.closest(".admin-page-framework-section-tabs-contents").createTabs("refresh")),i.attr("data-largest_index",Number(o)+1);i=i.find(".repeatable-section-remove-button");return 1<i.length&&i.show(),t};var b=function(e,a,t){var i=t.attr("data-section_id_model"),n=t.attr("data-section_name_model"),t=t.attr("data-flat_section_name_model");f(e).incrementAttribute("id",a,i),f(e).find("tr.admin-page-framework-fieldrow, .admin-page-framework-fieldset, .admin-page-framework-fields, .admin-page-framework-field, table.form-table, input,textarea,select,option").incrementAttribute("id",a,i),f(e).find(".admin-page-framework-fields").incrementAttribute("data-field_tag_id_model",a,i),f(e).find(".admin-page-framework-fields").incrementAttributes(["data-field_name_model"],a,n),f(e).find(".admin-page-framework-fields").incrementAttributes(["data-field_name_flat","data-field_name_flat_model","data-field_address","data-field_address_model"],a,t),f(e).find("input[type=radio][data-id],input[type=checkbox][data-id],select[data-id]").incrementAttribute("data-id",a,i),f(e).find(".admin-page-framework-fieldset").incrementAttribute("data-field_id",a,i),f(e).find(".repeatable-field-add-button").incrementAttribute("data-id",a,i),f(e).find("label").incrementAttribute("for",a,i),f(e).find("input:not(.element-address),textarea,select").incrementAttribute("name",a,n),f(e).find("a.anchor").incrementAttribute("href",a,i),f(e).find("input[type=hidden].element-address").incrementAttributes(["name","value","data-field_address_model"],a,t)};f.fn.removeAdminPageFrameworkRepeatableSection=function(){var e=f(this).closest(".admin-page-framework-section"),a=e.attr("id"),t=f(this).closest(".admin-page-framework-sections"),i=t.attr("id"),n=f(this).closest(".admin-page-framework-section-tabs-contents").children(".admin-page-framework-section-tabs").first(),r=n.children(".admin-page-framework-section-tab"),o=(t.attr("data-largest_index"),f.fn.aAdminPageFrameworkRepeatableSectionsOptions[i].fadein,f.fn.aAdminPageFrameworkRepeatableSectionsOptions[i].fadeout),d=f.fn.aAdminPageFrameworkRepeatableSectionsOptions[i].min;if(0!=d&&t.find(".admin-page-framework-section").length<=d){var s=e.find(".admin-page-framework-repeatable-section-buttons").last(),l=f(this).formatPrintText(p.messages.cannotRemoveMoreSections,d),l=f('<span class="repeatable-section-error" id="repeatable-section-error-'+i+'">'+l+"</span>");return 0<t.find("#repeatable-section-error-"+i).length?t.find("#repeatable-section-error-"+i).replaceWith(l):s.before(l),void l.delay(2e3).fadeOut(o)}s=e.nextAll(),l=e.hasClass("is_subsection_collapsible");e.fadeOut(o,function(){f(this).remove();var e=t.find(".repeatable-section-remove-button");1===e.length&&(e.css("display","none"),(e=t.find(".admin-page-framework-section-caption").first().attr("data-section_tab"))&&"_default"!==e||t.find(".admin-page-framework-section-title").first().show())}),s.each(function(e){}),0<n.length&&1<r.length&&!l&&(((a=n.find("#section_tab-"+a)).prev().length?a.prev():a.next()).addClass("active"),a.fadeOut(o,function(){f(this).delay(100).remove()}),n.closest(".admin-page-framework-section-tabs-contents").createTabs("refresh"))}}(jQuery);