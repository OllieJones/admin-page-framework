!function(s){var m=AdminPageFrameworkScriptFormMain;s.fn.updateAdminPageFrameworkRepeatableFields=function(e){var a=this,t=a.find(".repeatable-field-add-button").first().data("id"),r=s("#"+t),e=s.extend({max:0,min:0,fadein:500,fadeout:500,disabled:!1,preserve_values:0},e);r.data("repeatable")||r.data("repeatable",e);r=s(a).find(".admin-page-framework-repeatable-field-buttons").filter(function(){return s(this).closest(".admin-page-framework-fields").attr("id")===t});r.attr("data-max",e.max),r.attr("data-min",e.min),r.attr("data-fadein",e.fadein),r.attr("data-fadeout",e.fadeout),r.attr("data-preserve_values",e.preserve_values);r=s(a).find(".repeatable-field-add-button");r.off("click"),r.on("click",function(){if(s(this).parent().data("disabled")){var e=s(this).parent().data("disabled");return tb_show(e.caption,s(this).attr("href")),!1}return s(this).addAdminPageFrameworkRepeatableField(),!1});a=s(a).find(".repeatable-field-remove-button");a.off("click"),a.on("click",function(){return s(this).removeAdminPageFrameworkRepeatableField(),!1});a=r.first().closest(".admin-page-framework-field").attr("id"),r=s("#"+t).find(".admin-page-framework-field").filter(function(){return s(this).closest(".admin-page-framework-fields").attr("id")===t}).length;0<e.min&&0<r&&0<e.min-r&&s("#"+a).addAdminPageFrameworkRepeatableField(a)},s.fn.addAdminPageFrameworkRepeatableField=function(e){void 0===e&&(e=s(this).closest(".admin-page-framework-field").attr("id"));var a=s("#"+e),t=a.clone(),r=a.closest(".admin-page-framework-fields"),i=r.attr("id"),d=r.data("repeatable"),n=(d=!d?{max:(o=a.find(".admin-page-framework-repeatable-field-buttons").filter(function(){return s(this).closest(".admin-page-framework-fields").attr("id")===i}).first()).attr("data-max"),min:o.attr("data-min"),fadein:o.attr("data-fadein"),fadeout:o.attr("data-fadeout"),preserve_values:o.attr("data-preserve_values")}:d).fadein,f=d.fadeout,l=d.max,e=r.find(".admin-page-framework-field").filter(function(){return s(this).closest(".admin-page-framework-fields").attr("id")===i}),o=a.find(".admin-page-framework-repeatable-field-buttons").filter(function(){return s(this).closest(".admin-page-framework-fields").attr("id")===i});if(0!=l&&e.length>=l){o=o.last(),l=s(this).formatPrintText(m.messages.cannotAddMore,l),l=s('<span class="repeatable-error repeatable-field-error" id="repeatable-error-'+i+'" >'+l+"</span>");return 0<r.find("#repeatable-error-"+i).length?r.find("#repeatable-error-"+i).replaceWith(l):o.before(l),void l.delay(2e3).fadeOut(f)}d.preserve_values||(t.find("input:not([type=radio], [type=checkbox], [type=submit], [type=hidden]),textarea").val(""),t.find("input[type=checkbox]").prop("checked",!1)),t.find(".repeatable-error").remove(),n?t.hide().insertAfter(a).delay(100).fadeIn(n):t.insertAfter(a),p(t,r),t.updateAdminPageFrameworkRepeatableFields(),a.find("input[type=radio][checked=checked]").prop("checked",!0).attr("checked","checked"),t.trigger("admin-page-framework_added_repeatable_field",[t.data("type"),t.attr("id"),0,0,0]),s(t).find(".admin-page-framework-field").addBack().trigger("admin-page-framework_repeated_field",[0,jQuery(t).closest(".admin-page-framework-fields")]);a=r.find(".repeatable-field-remove-button").filter(function(){return s(this).closest(".admin-page-framework-fields").attr("id")===i});return 1<a.length&&a.css("visibility","visible"),r.children(".admin-page-framework-field").children(".delimiter").show().last().hide(),t};var p=function(e,a){var t=Number(a.attr("data-largest_index"));a.attr("data-largest_index",t+1);var r=a.attr("data-field_tag_id_model"),i=a.attr("data-field_name_model"),d=a.attr("data-field_name_flat_model"),a=a.attr("data-field_address_model");e.incrementAttribute("id",t,r),e.find("label").incrementAttribute("for",t,r),e.find("input,textarea,select,option").incrementAttribute("id",t,r),e.find("input,textarea,select").incrementAttribute("name",t,i),e.find("input[type=hidden].element-address").incrementAttributes(["name","value","data-field_address_model"],t,a),e.find("input[type=radio][data-id],input[type=checkbox][data-id],select[data-id]").incrementAttribute("data-id",t,r),e.find(".admin-page-framework-field,.admin-page-framework-fields,.admin-page-framework-fieldset").incrementAttributes(["id","data-field_tag_id_model","data-field_id"],t,r),e.find(".admin-page-framework-fields").incrementAttributes(["data-field_name_model"],t,i),e.find(".admin-page-framework-fields").incrementAttributes(["data-field_name_flat","data-field_name_flat_model"],t,d),e.find(".admin-page-framework-fields").incrementAttributes(["data-field_address","data-field_address_model"],t,a)};s.fn.removeAdminPageFrameworkRepeatableField=function(){var e,a=s(this).closest(".admin-page-framework-field"),t=s(this).closest(".admin-page-framework-fields"),r=t.attr("id"),i=t.data("repeatable"),d=i?i.min:0,n=t.find(".admin-page-framework-field").filter(function(){return s(this).closest(".admin-page-framework-fields").attr("id")===r});0!=d&&n.length<=d?(e=a.find(".admin-page-framework-repeatable-field-buttons").filter(function(){return s(this).closest(".admin-page-framework-fields").attr("id")===r}).last(),n=s(this).formatPrintText(m.messages.cannotRemoveMore,d),d=s('<span class="repeatable-error repeatable-field-error" id="repeatable-error-'+r+'">'+n+"</span>"),0<(n=t.find("#repeatable-error-"+r).filter(function(){return s(this).closest(".admin-page-framework-fields").attr("id")===r})).length?n.replaceWith(d):e.before(d),e=i?i.fadeout:500,d.delay(2e3).fadeOut(e)):(e=i?i.fadeout:500,a.fadeOut(e,function(){s(this).remove();var e=t.find(".repeatable-field-remove-button").filter(function(){return s(this).closest(".admin-page-framework-fields").attr("id")===r});1===e.length&&e.css("visibility","hidden")}))}}(jQuery);