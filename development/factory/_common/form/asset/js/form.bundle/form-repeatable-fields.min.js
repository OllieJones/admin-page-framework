!function(s){s(document).ready(function(){s(".admin-page-framework-fields.repeatable").each(function(){var e=s(this).siblings(".repeatable-field-buttons-model");if(!e.length)return!0;var a=e.data(),t=e.children(".admin-page-framework-repeatable-field-buttons").first(),i=s(t),r=s(t).clone();i.find(".repeatable-field-button").addClass("button-large"),r.find(".repeatable-field-button").addClass("button-small");e=s(this).find("> .admin-page-framework-field.without-child-fields"),t=e.find(".repeatable-field-buttons");0<t.length?t.replaceWith(r):e.find(".admin-page-framework-repeatable-field-buttons").length||e.prepend(r),s(this).find("> .admin-page-framework-field.with-child-fields").prepend(i),s(this).updateAdminPageFrameworkRepeatableFields(a)})});var m=AdminPageFrameworkScriptFormMain;s.fn.updateAdminPageFrameworkRepeatableFields=function(e){var a=this,t=a.find(".repeatable-field-add-button").first().data("id"),i=s("#"+t),e=s.extend({max:0,min:0,fadein:500,fadeout:500,disabled:!1,preserve_values:0},e);i.data("repeatable")||i.data("repeatable",e);i=s(a).find(".admin-page-framework-repeatable-field-buttons").filter(function(){return s(this).closest(".admin-page-framework-fields").attr("id")===t});i.attr("data-max",e.max),i.attr("data-min",e.min),i.attr("data-fadein",e.fadein),i.attr("data-fadeout",e.fadeout),i.attr("data-preserve_values",e.preserve_values);i=s(a).find(".repeatable-field-add-button");i.off("click"),i.on("click",function(){if(s(this).parent().data("disabled")){var e=s(this).parent().data("disabled");return tb_show(e.caption,s(this).attr("href")),!1}return s(this).addAdminPageFrameworkRepeatableField(),!1});a=s(a).find(".repeatable-field-remove-button");a.off("click"),a.on("click",function(){return s(this).removeAdminPageFrameworkRepeatableField(),!1});a=i.first().closest(".admin-page-framework-field").attr("id"),i=s("#"+t).find(".admin-page-framework-field").filter(function(){return s(this).closest(".admin-page-framework-fields").attr("id")===t}).length;0<e.min&&0<i&&0<e.min-i&&s("#"+a).addAdminPageFrameworkRepeatableField(a)},s.fn.addAdminPageFrameworkRepeatableField=function(e){void 0===e&&(e=s(this).closest(".admin-page-framework-field").attr("id"));var a=s("#"+e),t=a.clone(),i=a.closest(".admin-page-framework-fields"),r=i.attr("id"),d=i.data("repeatable"),n=(d=!d?{max:(o=a.find(".admin-page-framework-repeatable-field-buttons").filter(function(){return s(this).closest(".admin-page-framework-fields").attr("id")===r}).first()).attr("data-max"),min:o.attr("data-min"),fadein:o.attr("data-fadein"),fadeout:o.attr("data-fadeout"),preserve_values:o.attr("data-preserve_values")}:d).fadein,f=d.fadeout,l=d.max,e=i.find(".admin-page-framework-field").filter(function(){return s(this).closest(".admin-page-framework-fields").attr("id")===r}),o=a.find(".admin-page-framework-repeatable-field-buttons").filter(function(){return s(this).closest(".admin-page-framework-fields").attr("id")===r});if(0!=l&&e.length>=l){o=o.last(),l=s(this).formatPrintText(m.messages.cannotAddMore,l),l=s('<span class="repeatable-error repeatable-field-error" id="repeatable-error-'+r+'" >'+l+"</span>");return 0<i.find("#repeatable-error-"+r).length?i.find("#repeatable-error-"+r).replaceWith(l):o.before(l),void l.delay(2e3).fadeOut(f)}d.preserve_values||(t.find("input:not([type=radio], [type=checkbox], [type=submit], [type=hidden]),textarea").val(""),t.find("input[type=checkbox]").prop("checked",!1)),t.find(".repeatable-error").remove(),n?t.hide().insertAfter(a).delay(100).fadeIn(n):t.insertAfter(a),p(t,i),t.updateAdminPageFrameworkRepeatableFields(),a.find("input[type=radio][checked=checked]").prop("checked",!0).attr("checked","checked"),t.trigger("admin-page-framework_added_repeatable_field",[t.data("type"),t.attr("id"),0,0,0]),s(t).find(".admin-page-framework-field").addBack().trigger("admin-page-framework_repeated_field",[0,jQuery(t).closest(".admin-page-framework-fields")]);a=i.find(".repeatable-field-remove-button").filter(function(){return s(this).closest(".admin-page-framework-fields").attr("id")===r});return 1<a.length&&a.css("visibility","visible"),i.children(".admin-page-framework-field").children(".delimiter").show().last().hide(),t};var p=function(e,a){var t=Number(a.attr("data-largest_index"));a.attr("data-largest_index",t+1);var i=a.attr("data-field_tag_id_model"),r=a.attr("data-field_name_model"),d=a.attr("data-field_name_flat_model"),a=a.attr("data-field_address_model");e.incrementAttribute("id",t,i),e.find("label").incrementAttribute("for",t,i),e.find("input,textarea,select,option").incrementAttribute("id",t,i),e.find("input,textarea,select").incrementAttribute("name",t,r),e.find("input[type=hidden].element-address").incrementAttributes(["name","value","data-field_address_model"],t,a),e.find("input[type=radio][data-id],input[type=checkbox][data-id],select[data-id]").incrementAttribute("data-id",t,i),e.find(".admin-page-framework-field,.admin-page-framework-fields,.admin-page-framework-fieldset").incrementAttributes(["id","data-field_tag_id_model","data-field_id"],t,i),e.find(".admin-page-framework-fields").incrementAttributes(["data-field_name_model"],t,r),e.find(".admin-page-framework-fields").incrementAttributes(["data-field_name_flat","data-field_name_flat_model"],t,d),e.find(".admin-page-framework-fields").incrementAttributes(["data-field_address","data-field_address_model"],t,a)};s.fn.removeAdminPageFrameworkRepeatableField=function(){var e=s(this).closest(".admin-page-framework-field"),a=s(this).closest(".admin-page-framework-fields"),t=a.attr("id"),i=a.data("repeatable"),r=i?i.min:0,d=a.find(".admin-page-framework-field").filter(function(){return s(this).closest(".admin-page-framework-fields").attr("id")===t}),n=500;if(0!=r&&d.length<=r){var f=e.find(".admin-page-framework-repeatable-field-buttons").filter(function(){return s(this).closest(".admin-page-framework-fields").attr("id")===t}).last(),d=s(this).formatPrintText(m.messages.cannotRemoveMore,r),r=s('<span class="repeatable-error repeatable-field-error" id="repeatable-error-'+t+'">'+d+"</span>"),d=a.find("#repeatable-error-"+t).filter(function(){return s(this).closest(".admin-page-framework-fields").attr("id")===t});return 0<d.length?d.replaceWith(r):f.before(r),n=i?i.fadeout:500,void r.delay(2e3).fadeOut(n)}n=i?i.fadeout:500,e.fadeOut(n,function(){s(this).remove();var e=a.find(".repeatable-field-remove-button").filter(function(){return s(this).closest(".admin-page-framework-fields").attr("id")===t});1===e.length&&e.css("visibility","hidden")})}}(jQuery);