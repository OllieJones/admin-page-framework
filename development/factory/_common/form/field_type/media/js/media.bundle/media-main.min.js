!function(l){var e,i;e=["0.1.0",apfMedia],parseInt(apfMain.debugMode)&&console.log("APF Media Field Type:",...e),l(document).ready(function(){var a;function n(e,t){l("#"+e).val(t.url),l("#"+e+"_id").val(t.id),l("#"+e+"_caption").val(l("<div/>").text(t.caption).html()),l("#"+e+"_description").val(l("<div/>").text(t.description).html())}apfMedia.hasMediaUploader?i=function(e,i,a){var d,r=!1,e=l("#select_media_"+e);e.off("click"),e.on("click",function(e){var n=l(this).attr("id").substring(13),t=l("#"+n);if(window.wpActiveEditor=null,e.preventDefault(),"object"!=typeof d)return oAdminPageFrameworkOriginalMediaUploaderSelectObject=wp.media.view.MediaFrame.Select,wp.media.view.MediaFrame.Select=a?getAdminPageFrameworkCustomMediaUploaderSelectObject():oAdminPageFrameworkOriginalMediaUploaderSelectObject,(d=wp.media({title:a?apfMedia.label.insertFromURL:apfMedia.label.uploadFile,button:{text:apfMedia.label.useThisFile},library:{type:t.data("mime_types").length?t.data("mime_types"):[]},multiple:i,metadata:{}})).on("escape",function(){return!(r=!0)}),d.on("close",function(){var i,e=d.state();if(void 0!==e.props&&void 0!==e.props.attributes){var t,a={};for(t in e.props.attributes)a[t]=e.props.attributes[t]}void 0!==a?o(n,a):d.state().get("selection").each(function(e,t){e=e.hasOwnProperty("attributes")?e.attributes:{};if(0===t)return o(n,e),!0;t=void 0===i?l("#"+n).closest(".admin-page-framework-field"):i,t=(i=l(this).addAdminPageFrameworkRepeatableField(t.attr("id"))).find("input").attr("id");o(t,e)}),wp.media.view.MediaFrame.Select=oAdminPageFrameworkOriginalMediaUploaderSelectObject}),d.open(),!1;d.open()});var o=function(e,t,i){i=void 0===i?100:i,setTimeout(function(){r||n(e,t),r=!1},i)}}:(i=function(e,t,i){e=l("#select_media_"+e);e.off("click"),e.on("click",function(){var e=l(this).attr("id");window.sInputID=e.substring(13),window.original_send_to_editor=window.send_to_editor,window.send_to_editor=a;e=l(this).attr("data-enable_external_source");return tb_show(apfMedia.label.uploadFile,"media-upload.php?post_id=1&amp;enable_external_source="+e+"&amp;referrer="+apfMedia.referer+"&amp;button_label="+apfMedia.label.useThisFile+"&amp;type=image&amp;TB_iframe=true",!1),!1})},a=function(e,t){var i="<div>"+e+"</div>",a=l("a",i).attr("href"),e=l("a",i).attr("class"),i=e?e.replace(/(.*?)wp-image-/,""):"",e=window.sInputID;l("#"+e).val(a),l("#"+e+"_id").val(i),window.send_to_editor=window.original_send_to_editor,tb_remove()}),l(document).ready(function(){l("a.select_media.button").each(function(){i(l(this).data("input_id"),l(this).data("repeatable"),l(this).data("enable_external_source"))}),l("a.remove_media.button").on("click",function(){return n(l(this).data("input_id"),{}),!1}),l().registerAdminPageFrameworkCallbacks({repeated_field:function(e,t){e.find(".select_media.button, .remove_media.button").incrementAttributes(["id","data-input_id"],t.incremented_from,t.id);t=e.find(".media-field input");if(t.length<=0)return!0;i(t.attr("id"),!0,e.find(".select_media").attr("data-enable_external_source")),l("#remove_media_"+t.attr("id")).on("click",function(){return n(l(this).data("input_id"),{}),!1})}},apfMedia.fieldTypeSlugs)})})}(jQuery);