!function(g){AdminPageFrameworkScriptFormMain;var o=AdminPageFrameworkImageFieldType;o.hasMediaUploader=!!o.hasMediaUploader,g(document).ready(function(){var i;o.hasMediaUploader?(setAdminPageFrameworkImageUploader=function(a,t,i){var n,l=!1,e=g("#"+a+'[data-show_preview="1"]');e.off("change"),e.on("change",function(e){var t=g(this).val();g("<img>",{src:t,error:function(){},load:function(){setImagePreviewElement(a,{url:t})}})});e=g("#select_image_"+a);e.off("click"),e.on("click",function(e){var r=g(this).attr("id").substring(13);if(window.wpActiveEditor=null,e.preventDefault(),"object"!=typeof n)return oAdminPageFrameworkOriginalImageUploaderSelectObject=wp.media.view.MediaFrame.Select,wp.media.view.MediaFrame.Select=i?getAdminPageFrameworkCustomMediaUploaderSelectObject():oAdminPageFrameworkOriginalImageUploaderSelectObject,(n=wp.media({id:r,title:i?o.label.insertFromURL:o.label.uploadImage,button:{text:o.label.useThisImage},type:"image",library:{type:"image"},multiple:t,metadata:{}})).on("escape",function(){return!(l=!0)}),n.on("close",function(){var a,e=n.state();if(void 0!==e.props&&void 0!==e.props.attributes){var t,i={};for(t in e.props.attributes)i[t]=e.props.attributes[t]}void 0!==i?d(r,i):n.state().get("selection").each(function(e,t){e=e.hasOwnProperty("attributes")?e.attributes:{};if(0===t)return d(r,e),!0;t=void 0===a?g("#"+r).closest(".admin-page-framework-field"):a,t=(a=g(this).addAdminPageFrameworkRepeatableField(t.attr("id"))).find("input").attr("id");d(t,e)}),wp.media.view.MediaFrame.Select=oAdminPageFrameworkOriginalImageUploaderSelectObject}),n.open(),!1;n.open()});var d=function(e,t,a){a=void 0===a?100:a,setTimeout(function(){l||setImagePreviewElement(e,t),l=!1},a)}},setImagePreviewElement=function(e,t){t=g.extend(!0,{caption:"",alt:"",title:"",url:"",id:"",width:"",height:"",align:"",link:""},t);var a=g("<div/>").text(t.caption).html(),i=g("<div/>").text(t.alt).html(),r=g("<div/>").text(t.title).html();g("input#"+e).val(t.url),g("input#"+e+"_id").val(t.id),g("input#"+e+"_width").val(t.width),g("input#"+e+"_height").val(t.height),g("input#"+e+"_caption").val(a),g("input#"+e+"_alt").val(i),g("input#"+e+"_title").val(r),g("input#"+e+"_align").val(t.align),g("input#"+e+"_link").val(t.link);var n=g("#image_preview_"+e);n.attr("data-id",t.id),n.attr("data-width",t.width),n.attr("data-height",t.height),n.attr("data-caption",a),n.attr("alt",i),n.attr("title",r),n.attr("src",t.url),t.url?g("#image_preview_container_"+e).show():g("#image_preview_container_"+e).hide()},g().registerAdminPageFrameworkCallbacks({repeated_field:function(e,t){1===t.call_type&&e.find("input").first().val()||(e.find(".image_preview").hide(),e.find(".image_preview img").attr("src","")),e.find(".image_preview, .image_preview img, .select_image.button, .remove_image.button").incrementAttributes(["id","data-input_id"],t.incremented_from,t.id);t=e.closest(".admin-page-framework-field"),e=t.find(".select_image"),t=t.find(".image-field input");if(t.length<=0)return!0;setAdminPageFrameworkImageUploader(t.attr("id"),!0,e.attr("data-enable_external_source")),g("a#remove_image_"+t.attr("id")+".remove_image.button").on("click",function(e){return setImagePreviewElement(g(this).data("input_id"),{}),!1})}},o.fieldTypeSlugs),g("a.select_image.button").each(function(){setAdminPageFrameworkImageUploader(g(this).data("input_id"),g(this).data("repeatable"),g(this).data("enable_external_source"))}),g("a.remove_image.button").on("click",function(e){return setImagePreviewElement(g(this).data("input_id"),{}),!1})):(setAdminPageFrameworkImageUploader=function(e,t,a){e=g("#select_image_"+e);e.off("click"),e.on("click",function(){var e=g(this).attr("id");window.sInputID=e.substring(13),window.original_send_to_editor=window.send_to_editor,window.send_to_editor=i;e=g(this).attr("data-enable_external_source");return tb_show(o.label.uploadImage,"media-upload.php?post_id=1&amp;enable_external_source="+e+"&amp;referrer={$sReferrer}&amp;button_label="+o.label.useThisImage+"&amp;type=image&amp;TB_iframe=true",!1),!1})},i=function(e){var t="<div>"+e+"</div>",a=g("img",t).attr("src"),i=g("img",t).attr("alt"),r=g("img",t).attr("title"),n=g("img",t).attr("width"),l=g("img",t).attr("height"),d=g("img",t).attr("class"),o=d?d.replace(/(.*?)wp-image-/,""):"",m=e.replace(/\[(\w+).*?\](.*?)\[\/(\w+)\]/m,"$2").replace(/<a.*?>(.*?)<\/a>/m,""),s=e.replace(/^.*?\[\w+.*?\salign=(['"])(.*?)['"]\s.+$/gm,"$2"),p=g(t).find("a:first").attr("href"),m=g("<div/>").text(m).html(),e=g("<div/>").text(i).html(),r=g("<div/>").text(r).html(),t=window.sInputID;g("#"+t).val(a),g("#"+t+"_id").val(o),g("#"+t+"_width").val(n),g("#"+t+"_height").val(l),g("#"+t+"_caption").val(m),g("#"+t+"_alt").val(e),g("#"+t+"_title").val(r),g("#"+t+"_align").val(s),g("#"+t+"_link").val(p);p=g("#image_preview_"+t);p.attr("alt",i),p.attr("title",r),p.attr("data-classes",d),p.attr("data-id",o),p.attr("src",a),g("#image_preview_container_"+t).css("display",""),p.show(),window.send_to_editor=window.original_send_to_editor,tb_remove()})})}(jQuery);