!function(g){var a,t;t=["0.1.0",apfImage],parseInt(apfMain.debugMode)&&console.log("APF Image Field Type",...t),g(document).ready(function(){var i;function r(t,e){e=g.extend(!0,{caption:"",alt:"",title:"",url:"",id:"",width:"",height:"",align:"",link:""},e);var a=g("<div/>").text(e.caption).html(),i=g("<div/>").text(e.alt).html(),r=g("<div/>").text(e.title).html();g("input#"+t).val(e.url),g("input#"+t+"_id").val(e.id),g("input#"+t+"_width").val(e.width),g("input#"+t+"_height").val(e.height),g("input#"+t+"_caption").val(a),g("input#"+t+"_alt").val(i),g("input#"+t+"_title").val(r),g("input#"+t+"_align").val(e.align),g("input#"+t+"_link").val(e.link);var n=g("#image_preview_"+t);n.attr("data-id",e.id),n.attr("data-width",e.width),n.attr("data-height",e.height),n.attr("data-caption",a),n.attr("alt",i),n.attr("title",r),n.attr("src",e.url),e.url?g("#image_preview_container_"+t).show():g("#image_preview_container_"+t).hide()}apfImage.hasMediaUploader?a=function(a,i,n){var l,d=!1,t=g("#"+a+'[data-show_preview="1"]');t.off("change"),t.on("change",function(t){var e=g(this).val();g("<img>",{src:e,error:function(){},load:function(){r(a,{url:e})}})});t=g("#select_image_"+a);function o(t,e,a){d||g("#"+t).val()!==e.url&&(a=void 0===a?100:a,setTimeout(function(){g("#"+t).trigger("change")},a))}function m(t,e,a){a=void 0===a?100:a,setTimeout(function(){d||r(t,e),d=!1},a)}t.off("click"),t.on("click",function(t){var r=g(this).attr("id").substring(13),e=g("#"+r);if(window.wpActiveEditor=null,t.preventDefault(),"object"!=typeof l)return oAdminPageFrameworkOriginalImageUploaderSelectObject=wp.media.view.MediaFrame.Select,wp.media.view.MediaFrame.Select=n?getAdminPageFrameworkCustomMediaUploaderSelectObject():oAdminPageFrameworkOriginalImageUploaderSelectObject,(l=wp.media({id:r,title:n?apfImage.label.insertFromURL:apfImage.label.uploadImage,button:{text:apfImage.label.useThisImage},type:"image",library:{type:e.data("mime_types").length?e.data("mime_types"):"image"},multiple:i,metadata:{}})).on("escape",function(){return!(d=!0)}),l.on("close",function(){var a,t=l.state();if(void 0!==t.props&&void 0!==t.props.attributes){var e,i={};for(e in t.props.attributes)i[e]=t.props.attributes[e]}return void 0!==i?(m(r,i),o(r,i)):l.state().get("selection").each(function(t,e){t=t.hasOwnProperty("attributes")?t.attributes:{};if(0===e)return m(r,t),o(r,t),!0;e=void 0===a?g("#"+r).closest(".admin-page-framework-field"):a,e=(a=g(this).addAdminPageFrameworkRepeatableField(e.attr("id"))).find("input").attr("id");m(e,t),o(e,t)}),wp.media.view.MediaFrame.Select=oAdminPageFrameworkOriginalImageUploaderSelectObject,!1}),l.open(),!1;l.open()})}:(a=function(t,e,a){t=g("#select_image_"+t);t.off("click"),t.on("click",function(){var t=g(this).attr("id");window.sInputID=t.substring(13),window.original_send_to_editor=window.send_to_editor,window.send_to_editor=i;t=g(this).attr("data-enable_external_source");return tb_show(apfImage.label.uploadImage,"media-upload.php?post_id=1&amp;enable_external_source="+t+"&amp;referrer={$sReferrer}&amp;button_label="+apfImage.label.useThisImage+"&amp;type=image&amp;TB_iframe=true",!1),!1})},i=function(t){var e="<div>"+t+"</div>",a=g("img",e).attr("src"),i=g("img",e).attr("alt"),r=g("img",e).attr("title"),n=g("img",e).attr("width"),l=g("img",e).attr("height"),d=g("img",e).attr("class"),o=d?d.replace(/(.*?)wp-image-/,""):"",m=t.replace(/\[(\w+).*?\](.*?)\[\/(\w+)\]/m,"$2").replace(/<a.*?>(.*?)<\/a>/m,""),p=t.replace(/^.*?\[\w+.*?\salign=(['"])(.*?)['"]\s.+$/gm,"$2"),c=g(e).find("a:first").attr("href"),m=g("<div/>").text(m).html(),t=g("<div/>").text(i).html(),r=g("<div/>").text(r).html(),e=window.sInputID;g("#"+e).val(a),g("#"+e+"_id").val(o),g("#"+e+"_width").val(n),g("#"+e+"_height").val(l),g("#"+e+"_caption").val(m),g("#"+e+"_alt").val(t),g("#"+e+"_title").val(r),g("#"+e+"_align").val(p),g("#"+e+"_link").val(c);c=g("#image_preview_"+e);c.attr("alt",i),c.attr("title",r),c.attr("data-classes",d),c.attr("data-id",o),c.attr("src",a),g("#image_preview_container_"+e).css("display",""),c.show(),window.send_to_editor=window.original_send_to_editor,tb_remove()}),g().registerAdminPageFrameworkCallbacks({repeated_field:function(t,e){1===e.call_type&&t.find("input").first().val()||(t.find(".image_preview").hide(),t.find(".image_preview img").attr("src","")),t.find(".image_preview, .image_preview img, .select_image.button, .remove_image.button").incrementAttributes(["id","data-input_id"],e.incremented_from,e.id);e=t.closest(".admin-page-framework-field"),t=e.find(".select_image"),e=e.find(".image-field input");if(e.length<=0)return!0;a(e.attr("id"),!0,t.attr("data-enable_external_source")),g("#remove_image_"+e.attr("id")+".remove_image.button").on("click",function(t){return r(g(this).data("input_id"),{}),!1})}},apfImage.fieldTypeSlugs),g(".select_image.button").each(function(){a(g(this).data("input_id"),g(this).data("repeatable"),g(this).data("enable_external_source"))}),g(".remove_image.button").on("click",function(t){return r(g(this).data("input_id"),{}),g("#"+g(this).data("input_id")).trigger("change"),!1})})}(jQuery);